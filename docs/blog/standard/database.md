#### 数据库规范

```
数据库规范
星型模型
缓慢变化维（历史数据存储方式：SCD123）
宽表
统计表
历史数据
临时表
```

```
一、
    第一范式 字段不可分割
    第二范式 主键、外键为无意义的唯一id
    第三范式 不可重复存储,所有数据都可以由推断得到
    由于极端条件下连表join会产生很高的性能损耗，所以数据库字段冗余是有必要的，一般冗余不经常改变的对人有意义的数据，如身
份证、姓名、合同号等
    连表join尽量使用外键
二、
    尽量少使用视图、函数等数据库层面的设计开发
    尽量减少唯一约束、不可添加外键约束
三、
    1.必须建立一个只读账号，大损耗的聚合查询必须走只读从库
    2.关键业务跑批必须用主库保证正确性，对应的，数据查询与插入必须批量batch，涉及到聚合查询的情况必须对sql性能仔细斟酌，
忙时跑批频率高于1小时一次的扫表必须小于500w，如果达不到必须告知数据库管理员，否则视为违规
    3.从库的数据检查等级必须降低或者关闭以提高从库同步速度，减少从库延迟的几率
    4.主要表索引数不得超过6个,辅助表所引数不得超过3个，其他杂项表最好没有索引，只进行唯一值查找，经常一起合并查找的两个
字段可以设置联合索引，不可设置3个字段以上的联合索引
    5.生产中不可超过3表join，超大表只能join一次，最好不要join，自己在应用中组装。

杂项：
    1.数据库命名全部用小写英文加下划线_,存档的数据要在表名后面加年月日或者类似的能表明情况的命名
    2.表名使用 表头_表名 的格式，表头要表明该表的作用，如sys，biz，opt等

    3.删除使用逻辑删除字段名为 isdel char(1)
    4.主键使用bigint,但要规划好各个关键表的id范围,表规模不会很大的时候可以使用uuid
    5.统一几个字段名称：
        create_time
        update_time
        creator_id
        updater_id
        creator_name
        updater_name
        isdel
        status  关键业务状态,其他状态尽量用其他字段来表示
```

#### 一、建库建表规范：
```
1.【强制】 schema命名, 尽可能保持所有库不重名 (目前发现qr和db2中jufan重名)
2.【强制】 schema & table & 字段命名只允许使用 小写英文&下划线, 除分库分表外, 不允许使用数字
3.【强制】 所有table, 确保有主键
4.【强制】 所有字段必须有注释
5.【强制】 表名不使用复数名词
6.【强制】 不得使用外键与级联，一切外键概念必须在应用层解决
7.【强制】 禁用MySQL官方保留字段
8.【强制】 禁止使用中文json key
9.【强制】 所有table, 确保有创建人, 创建时间, 更新人, 更新时间字段（create_time,update_time,creator_name,updater_name)
10.【强制】 统一使用utf8mb4编码
# 11.【强制】 表达是与否概念的字段，必须使用is_xxx的方式命名，数据类型是unsigned tinyint（ 1表示是，0表示否）
12.【强制】 统一命名备份table, 以z_开头
13.【强制】 统一几个字段名称 create_time,update_time,creator_id,updater_id,creator_name,updater_name,xxx_status(关键业务状态,其他状态尽量用其他字段来表示)
14.【推荐】 字段允许适当冗余，以提高查询性能，但必须考虑数据一致。冗余字段应遵循：
      1）不是频繁修改的字段
      2）不是varchar超长字段，更不能是text字段
```
#### 二、索引规范
```
1.【强制】 主键索引名为pk_字段名；唯一索引名为uniq_字段名；普通索引名则为idx_字段名
2.【强制】 业务上具有唯一特性的字段，即使是多个字段的组合，也必须建成唯一索引
3.【强制】 建组合索引的时候，区分度最高的在最左边
4.【推荐】 超过三个表禁止join。需要join的字段，数据类型必须绝对一致；多表关联查询时，保证被关联的字段需要有索引
5.【推荐】 在varchar字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可
6.【推荐】 SQL性能优化的目标：至少要达到 range 级别，要求是ref级别，如果可以是consts最好
7.【推荐】 尽量使用分辨度更高的索引
# 扩展：
# 1、采用最左匹配原则
# 2、MySQL 8.0之前不支持混合排序
# 3、计算列里无法使用索引
# 4、否定条件中不能使用索引（<>、not in、not exists）
# 5、join字段类型不一致无法使用索引（CAHR和VARCHAR如果定义的长度一样可以使用索引）
# 6、字段字符集不一致无法使用索引
```

#### 三、SQL语句
```
1.【强制】 不要使用count(列名)或count(常量)来替代count(*)，count(*)是SQL92定义的标准统计行数的语法，跟数据库无关，跟NULL和非NULL无关
2.【强制】 使用ISNULL()来判断是否为NULL值。注意：NULL与任何值的直接比较都为NULL
3.【强制】 数据订正时，删除和修改记录时，要先select，避免出现误删除，确认无误才能执行更新语句
4.【强制】 所有表有状态变更时必须加变更记录--
5.【强制】 超过三个表禁止join。需要join的字段，数据类型必须绝对一致；多表关联查询时，保证被关联的字段需要有索引
6.【推荐】 不要使用SELECT *
7.【推荐】 不在索引列做数学或函数运算
8.【推荐】 避免%前缀模糊查询
```
#### 四、其他
```
1. 【强制】设置jdbc连接参数serverTimezone=Asia/Shanghai
2. 【强制】设置jdbc连接字符集为 utf8mb4
```